<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ISKAR - ØªØ·Ø¨ÙŠÙ‚Ùƒ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ</title>

    <meta property="og:title" content="ISKAR - ØªØ·Ø¨ÙŠÙ‚Ùƒ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ">
    <meta property="og:image" content="https://dogc7717-boop.github.io/Ramadan/cover.jpg">
    <meta property="og:description" content="Ù…Ø³Ø¨Ø­Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©ØŒ Ù…ÙˆØ§Ù‚ÙŠØª ØµÙ„Ø§Ø©ØŒ ÙˆØ£Ø°ÙƒØ§Ø± Ù…ØªØ¬Ø¯Ø¯Ø©.">
    <meta property="og:type" content="website">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#B8860B">

    <style>
        :root {
            --gold: #B8860B;
            --neon: 0 0 20px rgba(184, 134, 11, 0.7);
            --glass: rgba(255, 255, 255, 0.08);
        }

        body {
            background: #0a0e17 url('cover.jpg') no-repeat center center fixed;
            background-size: cover;
            color: white; margin: 0; font-family: 'Segoe UI', Tahoma, sans-serif;
            text-align: center; overflow-x: hidden;
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(10, 14, 23, 0.85);
            backdrop-filter: blur(15px);
            border: 1px solid var(--gold);
            border-radius: 25px;
            box-shadow: var(--neon);
            margin: 10px auto;
            width: 90%;
        }

        #guideModal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 30px; z-index: 3000; width: 85%; max-width: 450px;
            display: none;
        }

        .circular-counter {
            width: 210px; height: 210px; border-radius: 50%;
            border: 6px solid var(--gold); margin: 30px auto;
            display: flex; align-items: center; justify-content: center;
            font-size: 4.5rem; box-shadow: var(--neon); cursor: pointer;
            background: var(--glass); transition: 0.2s;
        }
        .circular-counter:active { transform: scale(0.92); }

        .btn-neon {
            background: var(--gold); color: white; border: none; padding: 12px 25px;
            border-radius: 15px; cursor: pointer; font-weight: bold; box-shadow: var(--neon);
            margin: 10px;
        }

        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.9);
            display: flex; justify-content: space-around; padding: 15px 0;
            border-top: 1px solid var(--gold); z-index: 1000;
        }
        .nav-bar span { cursor: pointer; color: var(--gold); font-weight: bold; }
        .nav-bar span.active { text-shadow: var(--neon); color: #fff; }

        .page { padding: 20px 15px 120px; animation: fadeIn 0.5s; display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .table-wrapper {
            width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch;
            border-radius: 15px; background: var(--glass);
            border: 1px solid rgba(184, 134, 11, 0.3); margin-top: 20px;
        }

        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid rgba(184, 134, 11, 0.2); font-size: 0.85rem; white-space: nowrap; }
        th { background: rgba(184, 134, 11, 0.1); color: var(--gold); position: sticky; top: 0; }
        .day-col { background: rgba(0, 0, 0, 0.7); color: var(--gold); font-weight: bold; position: sticky; right: 0; z-index: 10; }

        #live-clock { font-size: 2rem; font-weight: bold; color: var(--gold); text-shadow: var(--neon); }
        .match-alert { background: var(--gold) !important; color: black !important; animation: pulse 1s infinite; font-weight: bold; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body onclick="enableAudio()">

    <header style="padding:15px; background:rgba(0,0,0,0.8); color:var(--gold); font-size: 1.5rem; font-weight:bold; border-bottom: 1px solid var(--gold);">ISKAR</header>

    <div id="guideModal" class="glass-panel">
        <h2 style="color: var(--gold);">ğŸ’¡ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ù‡Ø§Ù…Ø©</h2>
        <div style="text-align: right; line-height: 1.8;">
            <p>1ï¸âƒ£ <b>ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:</b> Ø§Ø¶ØºØ· ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª.</p>
            <p>2ï¸âƒ£ <b>Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù…:</b> Ø§Ø³ØªØ«Ù†Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø£Ø°Ø§Ù†.</p>
        </div>
        <button class="btn-neon" onclick="startInstall()">Ø­Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù†</button>
    </div>

    <main>
        <section id="tasbihPage" class="page" style="display: block;">
            <div class="circular-counter" onclick="handleTasbih()">
                <span id="displayNum">0</span>
            </div>
            <div id="tasbihType" style="font-size: 1.3rem; margin-bottom: 20px;">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</div>
            <div style="margin-bottom: 20px;">
                <button class="btn-neon" onclick="setMode('Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡')">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</button>
                <button class="btn-neon" onclick="setMode('Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡')">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡</button>
                <button class="btn-neon" onclick="setMode('Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±')">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</button>
            </div>
            <div style="margin-bottom: 10px;">
                 <button onclick="resetCounter()" style="background:none; border:1px solid red; color:red; border-radius:10px; padding:5px 15px; cursor:pointer;">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ ğŸ”„</button>
            </div>
            <div class="glass-panel" style="display: inline-block; padding: 10px 20px;">
                ğŸ”Š <input type="checkbox" id="soundToggle" checked> 
                ğŸ“³ <input type="checkbox" id="vibrateToggle" checked>
            </div>
            <div id="historyLog" class="glass-panel" style="margin-top:20px; font-size: 0.9rem; padding: 10px;">
                <div style="color: var(--gold); margin-bottom: 5px;">Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¨ÙŠØ­</div>
                <div id="logItems"></div>
            </div>
        </section>

        <section id="prayerPage" class="page">
            <div class="glass-panel clock-screen">
                <div id="live-clock">00:00:00</div>
                <div id="status" style="font-size: 0.9rem; margin-top: 5px;">Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ±Ø§Ù‚Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¢Ù†...</div>
                
                <div style="margin-top: 15px; border-top: 1px solid rgba(184,134,11,0.3); padding-top: 10px;">
                    <label style="font-size: 0.8rem; color: var(--gold);">Ù†ØºÙ…Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:</label>
                    <select id="alarmSoundSelect" class="btn-neon" style="padding: 5px; font-size: 0.8rem; background: #000; color: #fff; width: 55%;">
                        <option value="Egypt_1.mp3">ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù† 1</option>
                        <option value="Egypt_2.mp3">ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù† 2</option>
                        <option value="Egypt_3.mp3">ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù† 3</option>
                        <option value="sine">Ø·Ù†ÙŠÙ† ØªÙ‚Ù†ÙŠ (Ù†Ø§Ø¹Ù…)</option>
                        <option value="square">ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø§Ø¯ (Ù‚ÙˆÙŠ)</option>
                    </select>
                    <button id="testBtn" onclick="toggleSound()" style="background:none; border:1px solid var(--gold); color:var(--gold); border-radius:5px; cursor:pointer; padding: 5px 10px; min-width: 85px;">ØªØ¬Ø±Ø¨Ø© ğŸ”Š</button>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table id="ramadanTable">
                    <thead>
                        <tr>
                            <th class="day-col">Ø§Ù„ÙŠÙˆÙ…</th>
                            <th>Ø¥Ù…Ø³Ø§Ùƒ</th>
                            <th>ÙØ¬Ø±</th>
                            <th>Ø¸Ù‡Ø±</th>
                            <th>Ø¹ØµØ±</th>
                            <th>Ù…ØºØ±Ø¨</th>
                            <th>Ø¹Ø´Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody"></tbody>
                </table>
            </div>
            <button id="installBtn" class="btn-neon" style="display:none; margin: 20px auto;">ğŸ“¥ ØªØ«Ø¨ÙŠØª ISKAR</button>
        </section>

        <section id="azkarPage" class="page">
            <div id="azkarContainer"></div>
        </section>
    </main>

    <nav class="nav-bar">
        <span id="navTasbih" class="active" onclick="showPage('tasbih')">Ø§Ù„Ù…Ø³Ø¨Ø­Ø©</span>
        <span id="navPrayer" onclick="showPage('prayer')">Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</span>
        <span id="navAzkar" onclick="showPage('azkar')">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</span>
    </nav>

    <script>
        let count = 0, currentMode = "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡", deferredPrompt, audioContext, isAudioReady = false;
        let currentAudio = null; // Ù„Ù„Ù…ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª

        const ramadanSchedule = [
            {day: "1 Ø±Ù…Ø¶Ø§Ù†", times: ["4:56", "5:06", "12:09", "3:20", "5:45", "7:03"]},
            {day: "2 Ø±Ù…Ø¶Ø§Ù†", times: ["4:55", "5:05", "12:09", "3:21", "5:46", "7:04"]},
            {day: "3 Ø±Ù…Ø¶Ø§Ù†", times: ["4:54", "5:04", "12:09", "3:21", "5:47", "7:04"]},
            {day: "4 Ø±Ù…Ø¶Ø§Ù†", times: ["4:53", "5:03", "12:09", "3:22", "5:47", "7:05"]},
            {day: "5 Ø±Ù…Ø¶Ø§Ù†", times: ["4:53", "5:03", "12:09", "3:22", "5:48", "7:06"]},
            {day: "6 Ø±Ù…Ø¶Ø§Ù†", times: ["4:52", "5:02", "12:08", "3:22", "5:49", "7:06"]},
            {day: "7 Ø±Ù…Ø¶Ø§Ù†", times: ["4:51", "5:01", "12:08", "3:23", "5:50", "7:07"]},
            {day: "8 Ø±Ù…Ø¶Ø§Ù†", times: ["4:50", "5:00", "12:08", "3:23", "5:51", "7:08"]},
            {day: "9 Ø±Ù…Ø¶Ø§Ù†", times: ["4:49", "4:59", "12:08", "3:24", "5:51", "7:09"]},
            {day: "10 Ø±Ù…Ø¶Ø§Ù†", times: ["4:48", "4:58", "12:08", "3:24", "5:52", "7:09"]},
            {day: "11 Ø±Ù…Ø¶Ø§Ù†", times: ["4:47", "4:57", "12:07", "3:24", "5:53", "7:10"]},
            {day: "12 Ø±Ù…Ø¶Ø§Ù†", times: ["4:46", "4:56", "12:07", "3:25", "5:53", "7:11"]},
            {day: "13 Ø±Ù…Ø¶Ø§Ù†", times: ["4:44", "4:54", "12:07", "3:25", "5:54", "7:12"]},
            {day: "14 Ø±Ù…Ø¶Ø§Ù†", times: ["4:43", "4:53", "12:07", "3:25", "5:55", "7:12"]},
            {day: "15 Ø±Ù…Ø¶Ø§Ù†", times: ["4:42", "4:52", "12:06", "3:26", "5:55", "7:13"]},
            {day: "16 Ø±Ù…Ø¶Ø§Ù†", times: ["4:41", "4:51", "12:06", "3:26", "5:56", "7:14"]},
            {day: "17 Ø±Ù…Ø¶Ø§Ù†", times: ["4:40", "4:50", "12:06", "3:26", "5:57", "7:14"]},
            {day: "18 Ø±Ù…Ø¶Ø§Ù†", times: ["4:38", "4:48", "12:06", "3:27", "5:57", "7:15"]},
            {day: "19 Ø±Ù…Ø¶Ø§Ù†", times: ["4:37", "4:47", "12:05", "3:27", "5:58", "7:16"]},
            {day: "20 Ø±Ù…Ø¶Ø§Ù†", times: ["4:36", "4:46", "12:05", "3:27", "5:59", "7:17"]},
            {day: "21 Ø±Ù…Ø¶Ø§Ù†", times: ["4:35", "4:45", "12:05", "3:28", "5:59", "7:17"]},
            {day: "22 Ø±Ù…Ø¶Ø§Ù†", times: ["4:33", "4:43", "12:05", "3:28", "6:00", "7:18"]},
            {day: "23 Ø±Ù…Ø¶Ø§Ù†", times: ["4:32", "4:42", "12:04", "3:28", "6:01", "7:19"]},
            {day: "24 Ø±Ù…Ø¶Ø§Ù†", times: ["4:31", "4:41", "12:04", "3:29", "6:01", "7:19"]},
            {day: "25 Ø±Ù…Ø¶Ø§Ù†", times: ["4:30", "4:40", "12:04", "3:29", "6:02", "7:20"]},
            {day: "26 Ø±Ù…Ø¶Ø§Ù†", times: ["4:28", "4:38", "12:04", "3:29", "6:03", "7:21"]},
            {day: "27 Ø±Ù…Ø¶Ø§Ù†", times: ["4:27", "4:37", "12:03", "3:29", "6:03", "7:21"]},
            {day: "28 Ø±Ù…Ø¶Ø§Ù†", times: ["4:26", "4:36", "12:03", "3:30", "6:04", "7:22"]},
            {day: "29 Ø±Ù…Ø¶Ø§Ù†", times: ["4:25", "4:35", "12:03", "3:30", "6:05", "7:23"]},
            {day: "30 Ø±Ù…Ø¶Ø§Ù†", times: ["4:23", "4:33", "12:03", "3:30", "6:05", "7:24"]}
        ];

        function showPage(p) {
            document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
            document.querySelectorAll('.nav-bar span').forEach(s => s.classList.remove('active'));
            document.getElementById(p + 'Page').style.display = 'block';
            document.getElementById('nav' + p.charAt(0).toUpperCase() + p.slice(1)).classList.add('active');
            if(p === 'azkar') loadAzkar();
        }

        // --- Ø§Ù„Ù…Ø³Ø¨Ø­Ø© ÙˆØ§Ù„Ø³Ø¬Ù„ ---
        function setMode(m) { if(count > 0) recordResult(); currentMode = m; document.getElementById('tasbihType').innerText = m; count = 0; document.getElementById('displayNum').innerText = 0; }
        function handleTasbih() {
            count++; document.getElementById('displayNum').innerText = count;
            if(document.getElementById('vibrateToggle').checked) navigator.vibrate(60);
            if(document.getElementById('soundToggle').checked) { new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3').play().catch(()=>{}); }
        }
        function resetCounter() { if(count > 0) recordResult(); count = 0; document.getElementById('displayNum').innerText = 0; }
        function recordResult() {
            const log = document.getElementById('logItems');
            const div = document.createElement('div');
            div.style.borderBottom = "1px solid rgba(184,134,11,0.2)"; div.style.padding = "5px";
            div.innerHTML = `<span>${currentMode}:</span> <b style="color:var(--gold)">${count}</b>`;
            log.prepend(div);
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø·ÙˆØ± (ØªØ´ØºÙŠÙ„ ÙˆØ¥ÙŠÙ‚Ø§Ù) ---
        function enableAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                isAudioReady = true;
                document.getElementById('status').innerText = "ğŸ”Š Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø§Ù‡Ø²";
                document.getElementById('status').style.color = "#00ff88";
            }
        }

        function toggleSound() {
            if (currentAudio) { stopAllSounds(); } 
            else { testSound(); }
        }

        function stopAllSounds() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
            const btn = document.getElementById('testBtn');
            if(btn) {
                btn.innerText = "ØªØ¬Ø±Ø¨Ø© ğŸ”Š";
                btn.style.color = "var(--gold)";
                btn.style.borderColor = "var(--gold)";
            }
        }

        function triggerAutoAlarm() {
            if (!isAudioReady) return;
            stopAllSounds(); // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ø­Ø§Ù„ÙŠ

            const selectedValue = document.getElementById('alarmSoundSelect').value;
            const btn = document.getElementById('testBtn');

            if (selectedValue.endsWith('.mp3')) {
                currentAudio = new Audio('./' + selectedValue);
                if(btn) {
                    btn.innerText = "Ø¥ÙŠÙ‚Ø§Ù â¹";
                    btn.style.color = "#ff4d4d";
                    btn.style.borderColor = "#ff4d4d";
                }
                currentAudio.play().catch(e => {
                    console.error("Ø®Ø·Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù:", e);
                    playGeneratedTone('sine');
                });
                currentAudio.onended = stopAllSounds;
            } else {
                playGeneratedTone(selectedValue);
            }
        }

        function playGeneratedTone(type) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = type;
            if(type === 'sine') osc.frequency.setValueAtTime(440, audioContext.currentTime);
            else if(type === 'square') osc.frequency.setValueAtTime(200, audioContext.currentTime);
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5);
            osc.connect(gain); gain.connect(audioContext.destination);
            osc.start(); osc.stop(audioContext.currentTime + 1.5);
        }

        function testSound() {
            if(!isAudioReady) { enableAudio(); setTimeout(triggerAutoAlarm, 100); } 
            else { triggerAutoAlarm(); }
        }

        // --- Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª ÙˆØ§Ù„Ø³Ø§Ø¹Ø© ---
        function initTable() {
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = ramadanSchedule.map((item, dIdx) => `
                <tr><td class="day-col">${item.day}</td>
                ${item.times.map((time, tIdx) => `<td id="cell-${dIdx}-${tIdx}">${time}</td>`).join('')}
                </tr>`).join('');
        }

        function watchClock() {
            const now = new Date();
            const h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
            const h12 = h % 12 || 12;
            const timeStr = `${h12}:${m.toString().padStart(2, '0')}`;
            document.getElementById('live-clock').innerText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;

            ramadanSchedule.forEach((day, dIdx) => {
                day.times.forEach((time, tIdx) => {
                    const cell = document.getElementById(`cell-${dIdx}-${tIdx}`);
                    if (cell) {
                        if (time === timeStr) {
                            cell.classList.add('match-alert');
                            if (s === 0) triggerAutoAlarm();
                        } else cell.classList.remove('match-alert');
                    }
                });
            });
        }

        // --- Ø§Ù„Ø£Ø°ÙƒØ§Ø± ---
        async function loadAzkar() {
            let list = ["Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡", "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…", "Ø§Ù„Ù„Ù‡Ù… ØµÙ„Ù Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯"];
            try {
                const res = await fetch('azkar_dynamic.json');
                if(res.ok) {
                    const data = await res.json();
                    if(data.newZikr) list.unshift("âœ¨ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…: " + data.newZikr);
                }
            } catch(e) {}
            document.getElementById('azkarContainer').innerHTML = list.map(z => `<div class="glass-panel" style="padding: 20px; width: 85%; border-right: 5px solid var(--gold); text-align: right;">${z}</div>`).join('');
        }

        // --- PWA ---
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; document.getElementById('installBtn').style.display = 'block'; });
        async function startInstall() { document.getElementById('guideModal').style.display = 'none'; if(deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; } }
        document.getElementById('installBtn').onclick = () => { document.getElementById('guideModal').style.display = 'block'; };

        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
        window.onload = () => { initTable(); setInterval(watchClock, 1000); };
    </script>
</body>
    </html>
